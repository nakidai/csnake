#!/bin/sh

if [[ "$*" == *"--help"* ]] || [[ "$*" == *"-h"* ]]
then
    echo "Use environment variables to pass values:
    CC      - compiler (default: cc)
    CFLAGS  - flags for compiler
    LDFLAGS - flags for linker
    OUT     - out file (default: game
    SIZE    - size of game field
    DEFX    - start x
    DEFY    - start y"
    exit 1
fi

CC=${CC:-cc}
RM=${RM:-rm -f}
CFLAGS=${CFLAGS:-}
LDFLAGS=${LDFLAGS:-}
OUT=${OUT:-game}
SIZE=${SIZE:-10}
DEFX=${DEFX:-0}
DEFY=${DEFY:-0}

echo "Makefile configuration:"
echo "Compiler: $CC"
echo "Remove: $RM"
echo "CFLAGS: $CFLAGS"
echo "LDFLAGS: $LDFLAGS"
echo "Out file: $OUT"
echo
echo "Code configuration:"
echo "Size: $SIZE"
echo "Start x: $DEFX"
echo "Start y: $DEFY"

if ! test -d config; then
    if test -f config; then
        rm config
    fi
    mkdir config
fi

echo "CC = $CC
RM = $RM
CFLAGS = $CFLAGS
LDFLAGS = $LDFLAGS
OUT = $OUT" > config/config.mk

echo "#define SIZE $SIZE
#define DEFX $DEFX
#define DEFY $DEFY" > config/config.h
